!function t(e,n,r){function i(s,a){if(!n[s]){if(!e[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var u=n[s]={exports:{}};e[s][0].call(u.exports,function(t){var n=e[s][1][t];return i(n?n:t)},u,u.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e){function n(){}n.prototype.root="body",e.exports=n},{}],2:[function(t,e){function n(t){return this instanceof n?(this.$=$(t),void(this.length=this.$.length)):new n(t)}function r(e){var n=t("../vars").allElements;return n.filter(function(t){return t._id===e})[0]}var i=t("./common"),o=t("../utils"),s=t("../errors"),a=(s.FixmeError,"bj"),c="data-"+a;n.prototype=new i,o.extend(n.prototype,{constructor:n,remove:function(){BEM.DOM.destruct(this.$),this.$=null},replaceWith:function(t){var e=$(t);this.before(e),this.remove(),this.$=e,BEM.DOM.init(e)},append:function(t){BEM.DOM.append(this.$.eq(0),t)},prepend:function(t){BEM.DOM.prepend(this.$.eq(0),t)},after:function(t){BEM.DOM.after(this.$.eq(this.$.length-1),t)},before:function(t){BEM.DOM.before(this.$.eq(0),t),BEM.DOM.init()},html:function(t){BEM.DOM.update(this.$,t)},attr:function(){return this.$.attr.apply(this.$,arguments)}}),n.getBlockFromElement=function(t){var e=$(t),n=e.attr(c);if(n)return r(n);for(;e=e.parent()&&0!==e.length;)if(n=e.attr(c))return r(n);return null},n.getTargetFromEvent=function(t){return t.target.domElem.get(0)};var u={};n.bindTo=function(t,e){u[t._name]&&u[t._name][e]||BEM.blocks[t._name].on(e,function(e,n){t.handleEvent(e,n)})},n.init=function(){BEM.DOM.init()},e.exports=n},{"../errors":12,"../utils":14,"../vars":15,"./common":1}],3:[function(t,e){e.exports={"native":t("./native"),"i-bem":t("./i-bem")}},{"./i-bem":2,"./native":4}],4:[function(t,e){function n(t){if(!(this instanceof n))return new n(t);if(t){if("string"==typeof t){var e=document.querySelectorAll(t);return s.extend(this,e),void(this.length=e.length)}if(t instanceof NodeList)return s.extend(this,t),void(this.length=t.length);if(t instanceof Element)return s.extend(this,[t]),void(this.length=1);throw new TypeError("Unknown query "+t)}}var r="bj",i="data-"+r,o=t("./common"),s=t("../utils");n.prototype=new o,s.extend(n.prototype,{constructor:n,remove:function(){for(var t=0;t<this.length;t++)this[t].parentElement.removeChild(this[t]),delete this[t]},replaceWith:function(t){var e=this[0].previousSibling;if(e)this.remove(),new n(e).after(t);else{var r=this[0].parentElement;this.remove(),new n(r).append(t)}},append:function(t){this[0].innerHTML+=t},prepend:function(t){this[0].innerHTML=t+=this[0].innerHTML},after:function(t){this[this.length-1].outerHTML+=t},before:function(t){this[0].outerHTML=t+this[0].outerHTML},html:function(t){this[0].innerHTML=t},attr:function(t,e){for(var n=0;n<this.length;n++){if(!e)return this[n].getAttribute(t);this[n].setAttribute(t,e)}}}),n.getTargetFromEvent=function(t){return t.target},n.getBlockFromElement=function(e){var n=t("../vars").adapter,r=n(e),o=r.attr(i),s=null;if(o&&t("../vars").allElements.some(function(t){return t._id===o?(s=t,!0):!1}),s)return s;for(var a=e,c=function(t){return t._id===o?(s=t,!0):!1};a=a.parentNode;)if(o=$(a).attr(i)){t("../vars").allElements.some(c);break}return s};var a={};n.bindTo=function(t,e){return a[e]?void a[e].push(t):(a[e]=[t],void document.addEventListener(e,function(t){var r=n.getBlockFromElement(t.target);r&&a[e].some(function(e){var n=r;if(e===n)return e.handleEvent(t),!0;if(!n.parent)return!1;for(;n=n.parent;)if(e===n)return e.handleEvent(t),!0;return!1})},!1))},n.init=function(){},e.exports=n},{"../utils":14,"../vars":15,"./common":1}],5:[function(t,e){function n(t){this._name=t.block,i.apply(this,arguments)}var r=t("../utils"),i=t("./primitive");n.prototype=Object.create(i.prototype),r.extend(n.prototype,{constructor:n,_formatData:function(t){return t}}),n.isBlock=function(t){return r.isPlainObject(t)&&t.block&&!t.elem?!0:!1},e.exports=n},{"../utils":14,"./primitive":10}],6:[function(t,e){function n(t,e){this.key=t,this._value=e}var r=t("./param"),i=t("../utils");n.prototype=new r,i.extend(n.prototype,{constructor:n,valueOf:function(t){var e={};return e[this.key]=this._value.apply(null,t),e}}),e.exports=n},{"../utils":14,"./param":9}],7:[function(t,e){function n(t){this._name=t.elem,i.apply(this,arguments)}var r=t("./block"),i=t("./primitive"),o=t("../utils");n.isElement=function(t){return o.isPlainObject(t)&&!t.block&&t.elem?!0:!1},n.prototype=Object.create(r.prototype),o.extend(n.prototype,{constructor:n,_formatData:function(t){return t.mods&&(t.elemMods=t.mods,delete t.mods),t.block&&(t.elem=t.block,delete t.block),t}}),n.prototype.constructor=n,n.prototype,e.exports=n},{"../utils":14,"./block":5,"./primitive":10}],8:[function(t,e){var n=t("./primitive"),r=t("./block"),i=t("./element");e.exports={createBemObject:function(t,e){if(n.isPrimitive(t))return new n(t,e);if(r.isBlock(t))return new r(t,e);if(i.isElement(t))return new i(t,e);throw new TypeError("Uknown type of bemjson: "+typeof t)}}},{"./block":5,"./element":7,"./primitive":10}],9:[function(t,e){function n(t,e){this._key=t,this._value=e}n.prototype={constructor:n,valueOf:function(){var e={},n=t("../utils");e[this._key]=this._value,this.valueOf=function(){var t={};return n.extend(t,e),t};var r={};return n.extend(r,e),r}},e.exports=n},{"../utils":14}],10:[function(t,e){function n(){return"uniqid-"+s++}function r(e,o){if(r.isPrimitive(e))throw new i("Plain types in bemjson not implemented yet");this.parent=o;var s=this;if(this.scope=this._createScope(o),window.allElements=this._allElements=t("../vars").allElements,this._allElements.push(this),this._id=n(),this._params=this._extractParams(e),this._events=this._getEventListeners(),this._mods=this._extractComplexParams(e.mods||{}),this._attrs=this._extractComplexParams(e.attrs||{}),this._content=this._extractContent(e.content),this._content||(this._children=this._extractChildren(e.content)),e.iterate){this._iterable=!0;var a=e.iterate.split(" ")[0].trim();this._iteratingBindingName=a,this._collectionName=e.iterate.split(" ")[2].trim(),this._collection=this.scope[this._collectionName]}this._bindings=this._extractBindings(e.bind),this._bindings.forEach(function(t){var e=this.scope[t];(e||(e=this._collection))&&["change","remove","add"].forEach(function(t){e.on(t,function(e){this._onModelChanged(t,e)},this)},this)},this),this._previousModelChanged=null;var c=e.showIf;this.isShown="function"==typeof c?function(t){return Boolean(c.apply(null,t||s._getModels()))}:function(){return!0},r.isPrimitive(e)||r.registerListeners(this,this._events)}var i=t("../errors").FixmeError,o=t("../utils"),s=0,a="bj",c="data-"+a,u="data-"+a+"x",l=t("./param"),h=t("./changeable-param");r.primitiveToBemjson=function(t){if(!r.isPrimitive(t))throw new TypeError("Not a primitive "+t+" "+JSON.stringify(t));return o.isPlainObject(t)?t:{content:t}},r.isPrimitive=function(t){return t?"string"==typeof t?!0:!o.isPlainObject(t)||t.elem||t.block?!1:!0:!0},r.registerListeners=function(e,n){var r=t("../vars").adapter;Object.keys(n).forEach(function(t){r.bindTo(e,t)})},r.prototype={constructor:r,isWasShown:function(){var t=this.getDomElement();return Boolean(t.length)},_onModelChanged:function(t,e){this._previousModelChanged=e.changed,this.repaint()},_createScope:function(e){var n;return n=e?e.scope:t("../vars").models,Object.create(n)},_extractBindings:function(t){return"string"==typeof t?t.split(" "):t||[]},_getModels:function(){return this._bindings.map(function(t){var e=this.scope;if(e[t])return e[t];throw new Error("No such model "+t)},this)},getPreviousSibling:function(){var t=this._allElements[this._allElements.indexOf(this)-1];return t&&t.parent===this.parent?t:null},_extractComplexParams:function(t){return Object.keys(t).map(function(e){return"function"==typeof t[e]?new h(e,t[e]):new l(e,t[e])})},_extractParams:function(t){var e=["block","elem","elemMods","mods","content","attrs","bind"],n={};return Object.keys(t).forEach(function(r){-1===e.indexOf(r)&&(n[r]=t[r])}),n},_extractContent:function(t){return null===t||void 0===t||"string"==typeof t||"number"==typeof t?function(){return t}:"function"==typeof t?t:null},_getEventListeners:function(){var t={},e=/^on[A-Z]+/;return Object.keys(this._params).forEach(function(n){e.test(n)&&(t[n.replace(/^on/,"").toLowerCase()]=this._params[n])},this),t},_extractChildren:function(e){var n=this,r=t("./");if(o.isPlainObject(e))return[r.createBemObject(e,n)];if(Array.isArray(e))return e.map(function(t){return r.createBemObject(t,n)});throw new TypeError("Uknown type of bemjson: "+e)},handleEvent:function(e){function n(t){var e=r(t),n=e.attr(u);if(n){var i=r.getBlockFromElement(t),o=JSON.parse(n);i.scope[o.name]=i._collection.models[o.index]}}var r=t("../vars").adapter,i=r.getTargetFromEvent(e);n(i);for(var o=i;o=o.parentElement;)n(o);var s=Array.prototype.slice.call(this._getModels());s.unshift(e),this._params["on"+e.type.charAt(0).toUpperCase()+e.type.slice(1,e.length)].apply(null,s)},getDomElement:function(){var e=t("../vars").adapter,n=e("["+c+"=%id]".replace("%id",this._id));return n},_getComplexParams:function(t){var e={};return this[t].map(function(t){o.extend(e,t.valueOf(this._getModels()))},this),Object.keys(e).forEach(function(t){e[t]||delete e[t]}),e},_getMods:function(){return this._getComplexParams("_mods")},_getAttrs:function(){return o.extend({"data-bj":this._id},this._getComplexParams("_attrs"))},toBemjson:function(){var t,e;if(this._loops=this._loops||((this.parent||{})._loops?this.parent._loops.slice():[]),this._iterable)this._loops.push(this._iteratingBindingName),t=this._collection.models.map(function(t,e){this.scope[this._iteratingBindingName]=t;var n=this._getModels(),r={};return r[u]=JSON.stringify({name:this._iteratingBindingName,index:e}),this.isShown(n)?this._formatData({block:this._name,mods:this._getMods(),content:this._content?this._content.apply(null,n):(this._children||[]).map(function(t){return t.toBemjson()},this),attrs:o.extend(r,this._getAttrs())}):null},this);else{if(!this.isShown())return null;e=this._formatData({block:this._name,mods:this._getMods(),content:this._getContent(),attrs:this._getAttrs()});for(var n in this._params)e[n]=this._params[n]}return t||e},_getContent:function(){if(this._content){var t=this._getModels();return this._content.apply(null,t)}return this._children?this._children.map(function(t){return t.toBemjson()},this):void 0},repaint:function(){var e=t("../vars").adapter,n=this.parent.isWasShown();if((!this.parent||n)&&this._params.repaint!==!1){var r;if(this.isWasShown()){var i=this.getDomElement();i.replaceWith(this.toHTML())}else{var o=this.getPreviousSibling();if(!o)return r=this.toHTML(),void(this.parent?this.parent.getDomElement().prepend(r):e(e().root).prepend(r));var s=null;if(o.isWasShown())s=o.getDomElement();else for(;o=o.getPreviousSibling();)o.isWasShown()&&(s=o.getDomElement());s?s.after(this.toHTML()):this.parent?this.parent.getDomElement().prepend(r):(r=this.toHTML(),e(e().root).prepend(r))}}},toHTML:function(){var e=t("../vars").templateEngine;return e.apply(this.toBemjson())}},e.exports=r},{"../errors":12,"../utils":14,"../vars":15,"./":8,"./changeable-param":6,"./param":9}],11:[function(t,e){var n=t("./utils");e.exports={init:function(e){var r=t("./vars");n.extend(r,e);var i=this.processBemJson(e.bemjson);window.tree=i;var o=e.templateEngine.apply(i.map(function(t){return t.toBemjson()}));r.adapter("body").html(o),r.adapter.init()},processBemJson:function(e){var r=t("./bem");if(Array.isArray(e))return e.map(function(t){return this.processBemJson(t)},this);if(n.isPlainObject(e))return r.createBemObject(e,null);throw new TypeError("Uknown type of bemjson: "+typeof e)},adapters:t("./adapters")}},{"./adapters":3,"./bem":8,"./utils":14,"./vars":15}],12:[function(t,e){function n(t){this.message=t}n.prototype=new Error,n.constructor=n,n.name="FIXME",e.exports={FixmeError:n}},{}],13:[function(t){!function(){this.bj=t("./bj")}()},{"./bj":11}],14:[function(t,e){function n(t,e){if("object"==typeof t&&"object"==typeof e){if(null===t||null===e)return t===e;for(var r in t)if("object"==typeof t[r]&&"object"==typeof e[r]){if(!n(t[r],e[r]))return!1}else if(t[r]!==e[r])return!1;return Object.keys(t).length===Object.keys(e).length}return t===e}e.exports={extend:function(t,e){var n;for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},isPlainObject:function(t){return null===t||"object"!=typeof t||t.nodeType||t===t.window?!1:t.constructor&&!Object.hasOwnProperty.call(t.constructor.prototype,"isPrototypeOf")?!1:!0},isSameObjects:n}},{}],15:[function(t,e){e.exports={allElements:[],models:{}}},{}]},{},[13]);