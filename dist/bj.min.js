!function t(e,n,r){function i(s,a){if(!n[s]){if(!e[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var u=n[s]={exports:{}};e[s][0].call(u.exports,function(t){var n=e[s][1][t];return i(n?n:t)},u,u.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e){function n(){}n.prototype.root="body",e.exports=n},{}],2:[function(t,e){function n(t){return this instanceof n?(this.$=$(t),void(this.length=this.$.length)):new n(t)}{var r=t("./common"),i=t("../utils"),o=t("../errors");o.FixmeError}n.prototype=new r,i.extend(n.prototype,{constructor:n,remove:function(){BEM.DOM.destruct(this.$)},replaceWith:function(t){BEM.DOM.replace(this.$,t)},append:function(t){BEM.DOM.append(this.$.eq(0),t)},prepend:function(t){BEM.DOM.prepend(this.$.eq(0),t)},after:function(t){BEM.DOM.after(this.$,t)},before:function(t){BEM.DOM.before(this.$,t)},html:function(t){BEM.DOM.update(this.$,t)},attr:function(){return this.$.attr.apply(this.$,arguments)}}),n.bindToDoc=function(t,e){document.addEventListener(t,e,!1)},n.init=function(){BEM.DOM.init()},e.exports=n},{"../errors":12,"../utils":14,"./common":1}],3:[function(t,e){e.exports={"native":t("./native"),"i-bem":t("./i-bem")}},{"./i-bem":2,"./native":4}],4:[function(t,e){function n(t){if(!(this instanceof n))return new n(t);if(t){if("string"==typeof t){var e=document.querySelectorAll(t);return i.extend(this,e),void(this.length=e.length)}if(t instanceof NodeList)return i.extend(this,t),void(this.length=t.length);if(t instanceof Element)return i.extend(this,[t]),void(this.length=1);throw new TypeError("Unknown query "+t)}}var r=t("./common"),i=t("../utils");n.prototype=new r,i.extend(n.prototype,{constructor:n,remove:function(){for(var t=0;t<this.length;t++)this[t].parentElement.removeChild(this[t]),delete this[t]},replaceWith:function(t){var e=this[0].previousSibling;if(e)this.remove(),e.after(t);else{var r=this[0].parentElement;this.remove(),new n(r).append(t)}},append:function(t){this[0].innerHTML+=t},prepend:function(t){this[0].innerHTML=t+=this[0].innerHTML},after:function(t){this[this.length-1].outerHTML+=t},before:function(t){this[0].outerHTML=t+this[0].outerHTML},html:function(t){this[0].innerHTML=t},attr:function(t,e){for(var n=0;n<this.length;n++){if(!e)return this[n].getAttribute(t);this[n].setAttribute(t,e)}}}),n.bindToDoc=function(t,e){document.addEventListener(t,e,!1)},n.init=function(){},e.exports=n},{"../utils":14,"./common":1}],5:[function(t,e){function n(t){i.apply(this,arguments),this._name=t.block}var r=t("../utils"),i=t("./primitive");n.prototype=Object.create(i.prototype),r.extend(n.prototype,{constructor:n,_formatData:function(t){return t}}),n.isBlock=function(t){return r.isPlainObject(t)&&t.block&&!t.elem?!0:!1},e.exports=n},{"../utils":14,"./primitive":10}],6:[function(t,e){function n(t,e){this.key=t,this._value=e}var r=t("./param");n.prototype={__proto__:r,constructor:n,valueOf:function(t){var e={};return e[this.key]=this._value.apply(null,t),e}},e.exports=n},{"./param":9}],7:[function(t,e){function n(t){i.apply(this,arguments),this._name=t.elem}var r=t("./block"),i=t("./primitive"),o=t("../utils");n.isElement=function(t){return o.isPlainObject(t)&&!t.block&&t.elem?!0:!1},n.prototype=Object.create(r.prototype),o.extend(n.prototype,{constructor:n,_formatData:function(t){return t.mods&&(t.elemMods=t.mods,delete t.mods),t.block&&(t.elem=t.block,delete t.block),t}}),n.prototype.constructor=n,n.prototype,e.exports=n},{"../utils":14,"./block":5,"./primitive":10}],8:[function(t,e){var n=t("./primitive"),r=t("./block"),i=t("./element");e.exports={createBemObject:function(t,e){if(n.isPrimitive(t))return new n(t,e);if(r.isBlock(t))return new r(t,e);if(i.isElement(t))return new i(t,e);throw new TypeError("Uknown type of bemjson: "+typeof t)}}},{"./block":5,"./element":7,"./primitive":10}],9:[function(t,e){function n(t,e){this._key=t,this._value=e}n.prototype={constructor:n,valueOf:function(){var e={},n=t("../utils");e[this._key]=this._value,this.valueOf=function(){var t={};return n.extend(t,e),t};var r={};return n.extend(r,e),r}},e.exports=n},{"../utils":14}],10:[function(t,e){function n(){return"uniqid-"+c++}function r(e,i){if(r.isPrimitive(e))throw new s("Plain types in bemjson not implemented yet");this.parent=i;var o=this;if(this.scope=this._createScope(i),window.allElements=this._allElements=t("../vars").allElements,this._allElements.push(this),this._id=n(),this._params=this._extractParams(e),this._events=this._getEventListeners(),this._mods=this._extractComplexParams(e.mods||{}),this._attrs=this._extractComplexParams(e.attrs||{}),this._content=this._extractContent(e.content),this._content||(this._children=this._extractChildren(e.content)),e.iterate){this._iterable=!0;var a=e.iterate.split(" ")[0].trim();this._iteratingBindingName=a,this._collectionName=e.iterate.split(" ")[2].trim(),this._collection=this.scope[this._collectionName]}this._bindings=this._extractBindings(e.bind),this._bindings.forEach(function(t){var e=this.scope[t];(e||(e=this._collection))&&["change","remove","add"].forEach(function(t){e.on(t,function(e){this._onModelChanged(t,e)},this)},this)},this),this._previousModelChanged=null;var c=e.showIf;this.isShown="function"==typeof c?function(t){return Boolean(c.apply(null,t||o._getModels()))}:function(){return!0},r.isPrimitive(e)||r.registerListeners(this,this._events)}function i(e){var n=t("../vars").adapter,r=n(e),i=r.attr(l),o=null;if(i&&t("../vars").allElements.some(function(t){return t._id===i?(o=t,!0):!1}),o)return o;for(var s=e;s=s.parentNode;)if(i=$(s).attr(l)){t("../vars").allElements.some(function(t){return t._id===i?(o=t,!0):!1});break}return o}function o(t){return i(t.target)}var s=t("../errors").FixmeError,a=t("../utils"),c=0,u="bj",l="data-"+u,h="data-"+u+"x",p=t("./param"),f=t("./changeable-param");r.primitiveToBemjson=function(t){if(!r.isPrimitive(t))throw new TypeError("Not a primitive "+t+" "+JSON.stringify(t));return a.isPlainObject(t)?t:{content:t}},r.isPrimitive=function(t){return t?"string"==typeof t?!0:!a.isPlainObject(t)||t.elem||t.block?!1:!0:!0},r.registerListeners=function(e,n){var r=this._registered=this._registered||{},i=t("../vars").adapter;Object.keys(n).forEach(function(t){r[t]?r[t].push(e):(i.bindToDoc(t,function(e){var n=o(e);n&&r[t].some(function(t){var r=n;if(t===r)return t.handleEvent(e),!0;if(!r.parent)return!1;for(;r=r.parent;)if(t===r)return t.handleEvent(e),!0;return!1})}),r[t]=[e])})},r.prototype={constructor:r,isWasShown:function(){var t=this.getDomElement();return Boolean(t.length)},_onModelChanged:function(t,e){this._previousModelChanged=e.changed,this.repaint()},_createScope:function(e){var n;return n=e?e.scope:t("../vars").models,Object.create(n)},_extractBindings:function(t){return"string"==typeof t?t.split(" "):t||[]},_getModels:function(){return this._bindings.map(function(t){var e=this.scope;if(e[t])return e[t];throw new Error("No such model "+t)},this)},getPreviousSibling:function(){var t=this._allElements[this._allElements.indexOf(this)-1];return t&&t.parent===this.parent?t:null},_extractComplexParams:function(t){return Object.keys(t).map(function(e){return"function"==typeof t[e]?new f(e,t[e]):new p(e,t[e])})},_extractParams:function(t){var e=["block","elem","elemMods","mods","content","attrs","bind"],n={};return Object.keys(t).forEach(function(r){-1===e.indexOf(r)&&(n[r]=t[r])}),n},_extractContent:function(t){return null===t||void 0===t||"string"==typeof t||"number"==typeof t?function(){return t}:"function"==typeof t?t:null},_getEventListeners:function(){var t={},e=/^on[A-Z]+/;return Object.keys(this._params).forEach(function(n){e.test(n)&&(t[n.replace(/^on/,"").toLowerCase()]=this._params[n])},this),t},_extractChildren:function(e){var n=this,r=t("./");if(a.isPlainObject(e))return[r.createBemObject(e,n)];if(Array.isArray(e))return e.map(function(t){return r.createBemObject(t,n)});throw new TypeError("Uknown type of bemjson: "+e)},handleEvent:function(e){function n(e){var n=t("../vars").adapter,r=n(e),o=r.attr(h);if(o){var s=i(e),a=JSON.parse(o);s.scope[a.name]=s._collection.models[a.index]}}n(e.target);for(var r=e.target;r=r.parentElement;)n(r);var o=Array.prototype.slice.call(this._getModels());o.unshift(e),this._params["on"+e.type.charAt(0).toUpperCase()+e.type.slice(1,e.length)].apply(null,o)},getDomElement:function(){var e=t("../vars").adapter,n=e("["+l+"=%id]".replace("%id",this._id));return n},_getComplexParams:function(t){var e={};return this[t].map(function(t){a.extend(e,t.valueOf(this._getModels()))},this),Object.keys(e).forEach(function(t){e[t]||delete e[t]}),e},_getMods:function(){return this._getComplexParams("_mods")},_getAttrs:function(){return a.extend({"data-bj":this._id},this._getComplexParams("_attrs"))},toBemjson:function(){if(this._loops=this._loops||((this.parent||{})._loops?this.parent._loops.slice():[]),this._iterable){this._loops.push(this._iteratingBindingName);var t=this._collection.models.map(function(t,e){this.scope[this._iteratingBindingName]=t;var n=this._getModels(),r={};return r[h]=JSON.stringify({name:this._iteratingBindingName,index:e}),this.isShown(n)?this._formatData({block:this._name,mods:this._getMods(),content:this._content?this._content.apply(null,n):(this._children||[]).map(function(t){return t.toBemjson()},this),attrs:a.extend(r,this._getAttrs())}):null},this)}else{if(!this.isShown())return null;var e=this._formatData({block:this._name,mods:this._getMods(),content:this._getContent(),attrs:this._getAttrs()});for(var n in this._params)e[n]=this._params[n]}return t||e},_getContent:function(){if(this._content){var t=this._getModels();return this._content.apply(null,t)}return this._children?this._children.map(function(t){return t.toBemjson()},this):void 0},repaint:function(){var e=t("../vars").adapter,n=this.parent.isWasShown();if((!this.parent||n)&&this._params.repaint!==!1)if(this.isWasShown()){var r=this.getDomElement();r.replaceWith(this.toHTML())}else{var i=this.getPreviousSibling();if(!i){var o=this.toHTML();return void(this.parent?this.parent.getDomElement().prepend(o):e(e().root).prepend(o))}var s=null;if(i.isWasShown())s=i.getDomElement();else for(;i=i.getPreviousSibling();)i.isWasShown()&&(s=i.getDomElement());if(s)s.after(this.toHTML());else if(this.parent)this.parent.getDomElement().prepend(o);else{var o=this.toHTML();e(e().root).prepend(o)}}},toHTML:function(){var e=t("../vars").templateEngine;return e.apply(this.toBemjson())}},e.exports=r},{"../errors":12,"../utils":14,"../vars":15,"./":8,"./changeable-param":6,"./param":9}],11:[function(t,e){var n=t("./utils");e.exports={init:function(e){var r=t("./vars");n.extend(r,e);var i=this.processBemJson(e.bemjson);window.tree=i;var o=e.templateEngine.apply(i.map(function(t){return t.toBemjson()}));r.adapter("body").html(o),r.adapter.init()},processBemJson:function(e){var r=t("./bem");if(Array.isArray(e))return e.map(function(t){return this.processBemJson(t)},this);if(n.isPlainObject(e))return r.createBemObject(e,null);throw new TypeError("Uknown type of bemjson: "+typeof e)},adapters:t("./adapters")}},{"./adapters":3,"./bem":8,"./utils":14,"./vars":15}],12:[function(t,e){function n(t){this.message=t}n.prototype=new Error,n.constructor=n,n.name="FIXME",e.exports={FixmeError:n}},{}],13:[function(t){!function(){this.bj=t("./bj")}()},{"./bj":11}],14:[function(t,e){function n(t,e){if("object"==typeof t&&"object"==typeof e){if(null===t||null===e)return t===e;for(var r in t)if("object"==typeof t[r]&&"object"==typeof e[r]){if(!n(t[r],e[r]))return!1}else if(t[r]!==e[r])return!1;return Object.keys(t).length===Object.keys(e).length}return t===e}e.exports={extend:function(t,e){var n;for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},isPlainObject:function(t){return null===t||"object"!=typeof t||t.nodeType||t===t.window?!1:t.constructor&&!Object.hasOwnProperty.call(t.constructor.prototype,"isPrototypeOf")?!1:!0},isSameObjects:n}},{}],15:[function(t,e){e.exports={allElements:[],models:{}}},{}]},{},[13]);